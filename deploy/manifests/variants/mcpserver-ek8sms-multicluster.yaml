apiVersion: kagent.dev/v1alpha1
kind: MCPServer
metadata:
  name: ek8sms-multicluster
  namespace: default
  labels:
    app.kubernetes.io/name: ek8sms
    app.kubernetes.io/component: mcp-server
    app.kubernetes.io/part-of: kubernetes-mcp
    app.kubernetes.io/mode: multicluster
spec:
  deployment:
    image: ghcr.io/friedrichwilken/extendable-kubernetes-mcp-server:latest
    port: 3000
    cmd: /app/extendable-k8s-mcp
    args:
      - --port=3000
      - --kubeconfig=/etc/kubernetes/config

    env:
      LOG_LEVEL: "info"
      TRANSPORT: "http"
      KUBECONFIG: "/etc/kubernetes/config"

    # Mount kubeconfig from secret
    secretRefs:
      - name: ek8sms-kubeconfig

    volumeMounts:
      - name: kubeconfig
        mountPath: /etc/kubernetes
        readOnly: true

    volumes:
      - name: kubeconfig
        secret:
          secretName: ek8sms-kubeconfig
          items:
            - key: config
              path: config

  # HTTP transport required for Kubernetes deployments
  transportType: http

  httpTransport:
    targetPort: 3000
    targetPath: /mcp

---
# Example secret for kubeconfig
# Create this secret before deploying:
#
# kubectl create secret generic ek8sms-kubeconfig \
#   --from-file=config=/path/to/your/kubeconfig
#
apiVersion: v1
kind: Secret
metadata:
  name: ek8sms-kubeconfig
  namespace: default
type: Opaque
# data:
#   config: <base64-encoded-kubeconfig>
